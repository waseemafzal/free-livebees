(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{"5uKh":function(e,t,s){"use strict";s.d(t,"a",(function(){return g}));var i=s("z6cu"),r=s("HDdC"),n=s("JIr8"),a=s("eIep"),o=s("fXoL"),c=s("tk/3"),l=s("Q+y8");let g=(()=>{class e{constructor(e,t){this.http=e,this.iframeController=t,this.cache=new Map}request(e,t,s,r,o){if("YES"===s){const s=this.cache.get(e);if(s)return void this.iframeController.gbRequestDidSuccessWithCache(t,s.data,s.url)}let c;c=r&&"POST"===r?this.http.post(e,o,{responseType:"blob"}):this.http.get(e,{responseType:"blob"}),c.pipe(Object(n.a)(e=>Object(i.a)({code:e.status,text:e.statusText})),Object(a.a)(e=>this.readData(e))).subscribe(s=>{this.iframeController.gbRequestDidSuccess(t,s.data,s.url),this.cache.set(e,{data:s.data,url:s.url})},e=>{this.iframeController.gbRequestDidFail(t,e.code,e.text)})}readData(e){return new r.a(t=>{const s=URL.createObjectURL(e),i=new FileReader;let r=()=>{const e=encodeURIComponent(i.result);t.next({data:e,url:s}),t.complete()},n=()=>{t.error({code:0,text:"File error"})};return i.addEventListener("load",r),i.addEventListener("error",n),i.readAsText(e),()=>{i.removeEventListener("load",r),i.removeEventListener("error",n)}})}}return e.\u0275fac=function(t){return new(t||e)(o.Wb(c.b),o.Wb(l.a))},e.\u0275prov=o.Ib({token:e,factory:e.\u0275fac}),e})()},FLOW:function(e,t,s){"use strict";s.d(t,"a",(function(){return u}));var i=s("ofXK"),r=s("HDdC"),n=s("eIep"),a=s("lJxs"),o=s("N1MX"),c=s("fXoL"),l=s("Q+y8"),g=s("5uKh");let u=(()=>{class e{constructor(e,t,s,i){this.authService=e,this.iframeController=t,this.geoloc=s,this.requestService=i}callMethod(e,t,s){switch(e){case"getlocation":this.getLocation();break;case"getmedia":const e=t.get("type");this.getMedia(e);break;case"gettimezoneoffset":this.getTimezoneOffset();break;case"getuser":this.getUser();break;case"request":const i=decodeURIComponent(t.get("url")),r=Number.parseInt(t.get("tag")),n=t.get("cache");let a;a=s?"POST":t.get("method"),this.request(i,r,n,a,s);break;case"setpreference":const o=t.get("key");let c=t.get("value");this.setPreference(o,c);break;case"getpreference":const l=t.get("key");this.getPreference(l);break;case"navigate.push":case"navigate.modal":const g=decodeURIComponent(t.get("page"));this.navigate(g);break;case"navigate.back":this.navigateBack();break;case"init":this.iframeController.initPlugin(),this.iframeController.setUserInfo(),this.iframeController.setPostData(s),this.iframeController.gbPluginDidLoad(),this.iframeController.gbViewDidAppear()}}getLocation(){this.geoloc.getCurrentPosition().subscribe(e=>this.iframeController.gbDidSuccessGetLocation(e),e=>this.iframeController.gbDidFailGetLocation(e&&e.message))}getMedia(e){this.createInput(e).pipe(Object(n.a)(e=>this.readMedia(e))).subscribe(e=>this.iframeController.gbDidSuccessGetMedia(e.data,e.url),e=>this.iframeController.gbDidFailGetMedia(e))}createInput(e){return new r.a(t=>{let s=Object(i.M)().createElement("input");s.setAttribute("type","file"),s.setAttribute("accept","video"===e?"video/*":"image/*");let r=e=>{const i=s.files;if(i.length>0){let e=i.item(0);const s=URL.createObjectURL(e);t.next({file:e,url:s}),t.complete()}else t.error("No file found")};return s.addEventListener("change",r),s.click(),()=>{s.removeEventListener("change",r),Object(i.M)().remove(s)}})}readMedia(e){return Object(o.readFileAsDataUrl)(e.file).pipe(Object(a.a)(t=>({url:e.url,data:encodeURIComponent(t)})))}getTimezoneOffset(){let e=(new Date).getTimezoneOffset();this.iframeController.gbDidSuccessGetTimezoneOffset(e)}getUser(){const e=this.authService.authenticatedUser;if(e){let t,s,i=new o.JsonObject(e.jsonUser).getJsonObject("attribs");i&&(t=i.getJsonObject("intern"),s=i.getJsonObject("socialAccountsUrl")),this.iframeController.gbDidSuccessGetUser({description:e.description,displayName:e.displayName,email:e.email,attribs:t?t.object:{},location:e.location,photoUrl:e.urlPhoto,socialAccounts:s?s.object:{},userId:e.unformattedId,userName:e.name,groups:e.groupsAsArray})}else this.iframeController.gbDidFailGetUser("No user found")}navigate(e){this.iframeController.navigateTo(e)}navigateBack(){this.iframeController.navigateBack()}request(e,t,s,i,r){this.requestService.request(e,t,s,i,r)}getPreference(e){let t=localStorage.getItem(e);this.iframeController.gbDidSuccessGetPreference(e,t)}setPreference(e,t){localStorage.setItem(e,t)}}return e.\u0275fac=function(t){return new(t||e)(c.Wb(o.AuthService),c.Wb(l.a),c.Wb(o.GeolocationManager),c.Wb(g.a))},e.\u0275prov=c.Ib({token:e,factory:e.\u0275fac}),e})()},MG5h:function(e,t,s){"use strict";var i=s("QySu");s.d(t,"PluginSettingsManager",(function(){return i.a}));var r=s("Q+y8");s.d(t,"PluginIFrameController",(function(){return r.a}));var n=s("FLOW");s.d(t,"PluginMethodsService",(function(){return n.a}));var a=s("5uKh");s.d(t,"PluginRequestService",(function(){return a.a}));var o=s("g5BR");s.d(t,"PluginLinksManager",(function(){return o.a})),s("l4Fm")},MbT3:function(e,t,s){"use strict";s.r(t),s.d(t,"PluginModule",(function(){return S})),s.d(t,"providePluginSettingsManager",(function(){return P}));var i=s("tyNb"),r=s("jXgJ"),n=s("mrSG"),a=s("ofXK"),o=s("xgIS"),c=s("uHTR"),l=s("fXoL"),g=s("jhN1"),u=s("MG5h"),h=s("N1MX"),d=s("OjYa"),f=s("8++q");const b=["pluginFrame"];function m(e,t){if(1&e&&(l.Sb(0,"gb-iframe-container"),l.Nb(1,"iframe",4,5),l.Rb()),2&e){const e=l.dc(2);l.Ab(1),l.kc("src",e.frameSrc,l.xc)}}function p(e,t){if(1&e&&(l.Sb(0,"gb-classic-layout",1),l.Sb(1,"div",2),l.Hc(2,m,3,1,"gb-iframe-container",3),l.Rb(),l.Rb()),2&e){const e=l.dc();l.kc("sectionId",e.sectionId),l.Ab(2),l.kc("ngIf",e.frameSrc)}}let M=(()=>{class e{constructor(e,t,s,i,r,n){this.route=e,this.sanitizer=t,this.settingsManager=s,this.iframeController=i,this.linksManager=r,this.platform=n,this.postParams={},this.filterDomain=new RegExp(this.settingsManager.getMostAccurateBaseUrl())}ngOnInit(){this.sectionId=this.route.snapshot.data.section,this.setPluginUrl(),this.messageSubscription=Object(o.a)(this.platform.windowRef,"message").subscribe(e=>{e.data.params&&(this.postParams=e.data.params),this.linksManager.handlePluginLink(e.data.url,this.sectionId,e.data.params).subscribe()})}ngAfterViewInit(){this.initFrame()}ngOnDestroy(){this.messageSubscription.unsubscribe()}setPluginUrl(){let e=this.settingsManager.getPluginUrl(this.sectionId);e+=(/\?/.exec(e)?"&":"?")+"define_function=1",this.frameSrc=this.sanitizer.bypassSecurityTrustResourceUrl(e),this.iframeController.baseUrl=e,this.initFrame()}initFrame(){if(this.frame){let e=this.frame.nativeElement;this.iframeController.frame=e,this.iframeController.baseUrl=this.settingsManager.getPluginUrl(this.sectionId),Object(a.M)().onAndCancel(e,"load",()=>{this.iframeController.initPlugin(),this.iframeController.setUserInfo(),this.iframeController.setPostData(this.postParams),this.postParams={},this.iframeController.gbPluginDidLoad(),this.iframeController.gbViewDidAppear()})}}}return e.\u0275fac=function(t){return new(t||e)(l.Mb(i.a),l.Mb(g.b),l.Mb(u.PluginSettingsManager),l.Mb(u.PluginIFrameController),l.Mb(u.PluginLinksManager),l.Mb(h.PlatformService))},e.\u0275cmp=l.Gb({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){var s;1&e&&l.Oc(b,!0),2&e&&l.qc(s=l.ac())&&(t.frame=s.first)},decls:1,vars:1,consts:[[3,"sectionId",4,"ngIf"],[3,"sectionId"],["id","frame-container"],[4,"ngIf"],["frameborder","0",3,"src"],["pluginFrame",""]],template:function(e,t){1&e&&l.Hc(0,p,3,2,"gb-classic-layout",0),2&e&&l.kc("ngIf",t.sectionId)},directives:[a.t,d.a,f.a],styles:["gb-classic-layout[_ngcontent-%COMP%]{height:inherit;flex:1}#frame-container[_ngcontent-%COMP%]{display:flex;flex:1}#frame-container[_ngcontent-%COMP%]   gb-iframe-container[_ngcontent-%COMP%]{height:inherit;flex:1}@media screen and (-ms-high-contrast:active),screen and (-ms-high-contrast:none){#frame-container[_ngcontent-%COMP%]{height:100vh}}"]}),Object(n.b)([Object(c.a)("sections")],e.prototype,"setPluginUrl",null),e})();var v=s("1oco");let S=(()=>{class e{}return e.\u0275mod=l.Kb({type:e}),e.\u0275inj=l.Jb({factory:function(t){return new(t||e)},providers:[{provide:u.PluginSettingsManager,useFactory:P,deps:[h.SettingsManager,h.LanguagesManager,h.Logger]},u.PluginIFrameController,u.PluginLinksManager,u.PluginMethodsService,u.PluginRequestService],imports:[[i.m.forChild([{path:"",component:M,pathMatch:"full"}]),v.a,r.a]]}),e})();function P(e,t,s){let i=new u.PluginSettingsManager(t,s);return i.settings=e.settings,i}},"Q+y8":function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var i=s("fXoL");let r=(()=>{class e{constructor(){this.history=new Array}gbPluginDidLoad(){this.postMessage("gbPluginDidLoad")}gbViewDidAppear(){this.postMessage("gbViewDidAppear")}gbDidFailGetLocation(e){this.postMessage("gbDidFailGetLocation",[e])}gbDidSuccessGetLocation(e){this.postMessage("gbDidSuccessGetLocation",[e.coords.latitude,e.coords.longitude])}gbDidFailGetMedia(e){this.postMessage("gbDidFailGetMedia",[e])}gbDidSuccessGetMedia(e,t){this.postMessage("gbDidSuccessGetMedia",[e,t])}gbDidSuccessGetTimezoneOffset(e){this.postMessage("gbDidSuccessGetTimezoneOffset",[e])}gbDidFailGetUser(e){this.postMessage("gbDidFailGetUser",[e])}gbDidSuccessGetUser(e){this.postMessage("gbDidSuccessGetUser",[JSON.stringify(e)])}gbDidSuccessGetPreference(e,t){this.postMessage("gbDidSuccessGetPreference",[e,t])}gbRequestDidFail(e,t,s){this.postMessage("gbRequestDidFail",[e,t,s])}gbRequestDidSuccess(e,t,s){this.postMessage("gbRequestDidSuccess",[e,t,s])}gbRequestDidSuccessWithCache(e,t,s){this.postMessage("gbRequestDidSuccessWithCache",[e,t,s])}navigateBack(){this.history.pop();const e=this.history[this.history.length-1];e?this.navigateTo(e):this.frame.src=this.baseUrl}navigateTo(e){const t=this.baseUrl.replace("/index.html",`/${e}.html`);this.frame.src=t,this.history.push(e)}initPlugin(){this.postMessage("gbWebsiteInitPlugin")}setPostData(e){this.setData("gbPostData",e)}setUserInfo(){const e={platform:"website",language:window.navigator.language};this.setData("gbUserInfo",e)}setData(e,t){this.postMessage("gbWebsiteSetData",[e,t])}postMessage(e,t){this.frame.contentWindow.postMessage({method:e,params:t},"*")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=i.Ib({token:e,factory:e.\u0275fac}),e})()},QySu:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var i=s("N1MX");class r extends i.SettingsManager{constructor(e,t){super(e,t)}getPluginUrl(e){return Object(i.getAbsoluteResourceUrl)(this.getMostAccurateBaseUrl(),this._getString(this.getSections(e),"sectionUrl",null))}}},g5BR:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var i=s("EY2u"),r=s("fXoL"),n=s("N1MX"),a=s("FLOW");let o=(()=>{class e{constructor(e,t){this.linksManager=e,this.pluginMethods=t}handlePluginLink(e,t,s){const r=this.getMethodName(e),n=this.getParams(e);return r&&"gotosection"!==r?(this.pluginMethods.callMethod(r,n,s),Object(i.b)()):this.linksManager.handleLink(e,t)}getMethodName(e){if("string"!=typeof e)return null;const t=e.split("?")[0].match(/goodbarber:\/\/([a-z\.]*)/);return t?t[1]:null}getParams(e){let t=new Map;if(e){const s=e.split("?")[1];s&&s.split("&").forEach(e=>{let s=e.split("=");t.set(s[0],s[1])})}return t}}return e.\u0275fac=function(t){return new(t||e)(r.Wb(n.LinksManager),r.Wb(a.a))},e.\u0275prov=r.Ib({token:e,factory:e.\u0275fac}),e})()},l4Fm:function(e,t){}}]);
//# sourceMappingURL=17-es2015.0ee0a0105f58ee9ac78b.js.map